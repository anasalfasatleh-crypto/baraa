openapi: 3.0.3
info:
  title: Research Data Collection Platform API
  description: |
    API for the ICU Delirium Psychoeducational Study platform.
    Supports pre/post-test questionnaires, educational materials, evaluator scoring, and data export.
  version: 1.0.0
  contact:
    name: Research Platform Team

servers:
  - url: /api/v1
    description: API base path

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Student
    description: Student-facing endpoints
  - name: Evaluator
    description: Evaluator-facing endpoints
  - name: Admin
    description: Administrator endpoints

paths:
  # ============ AUTH ============
  /auth/login:
    post:
      tags: [Auth]
      summary: Authenticate user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      operationId: refreshToken
      description: Uses HttpOnly refresh token cookie
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: Invalid or expired refresh token

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Logged out successfully

  /auth/change-password:
    post:
      tags: [Auth]
      summary: Change current user password
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '204':
          description: Password changed
        '400':
          description: Validation error

  # ============ STUDENT ============
  /student/status:
    get:
      tags: [Student]
      summary: Get student study progress
      operationId: getStudentStatus
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Student status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudentStatus'

  /student/pretest:
    get:
      tags: [Student]
      summary: Get pre-test questionnaire
      operationId: getPretest
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pre-test questionnaire with current answers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionnaireWithAnswers'
        '403':
          description: Pre-test already submitted

  /student/pretest/save:
    post:
      tags: [Student]
      summary: Save pre-test answers (auto-save)
      operationId: savePretestAnswers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveAnswersRequest'
      responses:
        '200':
          description: Answers saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveAnswersResponse'
        '403':
          description: Pre-test already submitted

  /student/pretest/submit:
    post:
      tags: [Student]
      summary: Submit pre-test (locks answers)
      operationId: submitPretest
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pre-test submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionResponse'
        '400':
          description: Incomplete required questions
        '403':
          description: Already submitted

  /student/materials:
    get:
      tags: [Student]
      summary: List educational materials
      operationId: getMaterials
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of materials
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Material'
        '403':
          description: Pre-test not completed

  /student/materials/{materialId}:
    get:
      tags: [Student]
      summary: Get material details and access URL
      operationId: getMaterial
      security:
        - bearerAuth: []
      parameters:
        - name: materialId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Material with signed URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaterialWithUrl'
        '404':
          description: Material not found

  /student/materials/{materialId}/track:
    post:
      tags: [Student]
      summary: Track material access duration
      operationId: trackMaterialAccess
      security:
        - bearerAuth: []
      parameters:
        - name: materialId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrackAccessRequest'
      responses:
        '204':
          description: Access tracked

  /student/posttest:
    get:
      tags: [Student]
      summary: Get post-test questionnaire
      operationId: getPosttest
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Post-test questionnaire
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionnaireWithAnswers'
        '403':
          description: Post-test not available or already submitted

  /student/posttest/save:
    post:
      tags: [Student]
      summary: Save post-test answers
      operationId: savePosttestAnswers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveAnswersRequest'
      responses:
        '200':
          description: Answers saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveAnswersResponse'

  /student/posttest/submit:
    post:
      tags: [Student]
      summary: Submit post-test
      operationId: submitPosttest
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Post-test submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmissionResponse'

  /student/step-timing:
    post:
      tags: [Student]
      summary: Record step timing
      operationId: recordStepTiming
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StepTimingRequest'
      responses:
        '204':
          description: Timing recorded

  # ============ EVALUATOR ============
  /evaluator/students:
    get:
      tags: [Evaluator]
      summary: List assigned students
      operationId: getAssignedStudents
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of assigned students
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AssignedStudent'

  /evaluator/students/{studentId}/responses:
    get:
      tags: [Evaluator]
      summary: Get student responses for scoring
      operationId: getStudentResponses
      security:
        - bearerAuth: []
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Student responses with scoring fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudentResponsesForScoring'
        '403':
          description: Student not assigned or post-test not submitted

  /evaluator/students/{studentId}/scores:
    post:
      tags: [Evaluator]
      summary: Save evaluator scores
      operationId: saveEvaluatorScores
      security:
        - bearerAuth: []
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveScoresRequest'
      responses:
        '200':
          description: Scores saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SaveScoresResponse'
        '403':
          description: Scores already finalized

  # ============ ADMIN ============
  /admin/dashboard:
    get:
      tags: [Admin]
      summary: Get dashboard metrics
      operationId: getDashboard
      security:
        - bearerAuth: []
      parameters:
        - name: hospital
          in: query
          schema:
            type: string
        - name: gender
          in: query
          schema:
            type: string
            enum: [male, female, other]
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardData'

  /admin/users:
    get:
      tags: [Admin]
      summary: List users
      operationId: listUsers
      security:
        - bearerAuth: []
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [admin, evaluator, student]
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Paginated user list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'

    post:
      tags: [Admin]
      summary: Create user
      operationId: createUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Validation error

  /admin/users/import:
    post:
      tags: [Admin]
      summary: Bulk import users from CSV/Excel
      operationId: importUsers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                role:
                  type: string
                  enum: [student, evaluator]
      responses:
        '200':
          description: Import results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResult'

  /admin/users/{userId}:
    get:
      tags: [Admin]
      summary: Get user details
      operationId: getUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDetail'

    patch:
      tags: [Admin]
      summary: Update user
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /admin/users/{userId}/activate:
    post:
      tags: [Admin]
      summary: Activate user
      operationId: activateUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User activated

  /admin/users/{userId}/deactivate:
    post:
      tags: [Admin]
      summary: Deactivate user
      operationId: deactivateUser
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User deactivated

  /admin/users/{userId}/reset-password:
    post:
      tags: [Admin]
      summary: Reset user password
      operationId: resetUserPassword
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: New temporary password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResetPasswordResponse'

  /admin/evaluator-assignments:
    get:
      tags: [Admin]
      summary: List evaluator assignments
      operationId: listAssignments
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Assignment list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvaluatorAssignment'

    post:
      tags: [Admin]
      summary: Assign evaluator to student
      operationId: createAssignment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAssignmentRequest'
      responses:
        '201':
          description: Assignment created
        '400':
          description: Student already assigned

  /admin/questionnaires:
    get:
      tags: [Admin]
      summary: List questionnaires
      operationId: listQuestionnaires
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Questionnaire list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Questionnaire'

    post:
      tags: [Admin]
      summary: Create questionnaire
      operationId: createQuestionnaire
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuestionnaireRequest'
      responses:
        '201':
          description: Questionnaire created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Questionnaire'

  /admin/questionnaires/{questionnaireId}:
    get:
      tags: [Admin]
      summary: Get questionnaire with questions
      operationId: getQuestionnaire
      security:
        - bearerAuth: []
      parameters:
        - name: questionnaireId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Full questionnaire
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionnaireDetail'

    put:
      tags: [Admin]
      summary: Update questionnaire
      operationId: updateQuestionnaire
      security:
        - bearerAuth: []
      parameters:
        - name: questionnaireId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateQuestionnaireRequest'
      responses:
        '200':
          description: Questionnaire updated
        '403':
          description: Cannot modify after submissions exist

  /admin/materials:
    get:
      tags: [Admin]
      summary: List materials
      operationId: listMaterials
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Material list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Material'

    post:
      tags: [Admin]
      summary: Upload material
      operationId: uploadMaterial
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [title, type]
              properties:
                title:
                  type: string
                description:
                  type: string
                type:
                  type: string
                  enum: [pdf, video, text]
                file:
                  type: string
                  format: binary
                textContent:
                  type: string
      responses:
        '201':
          description: Material created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Material'

  /admin/posttest-batch:
    get:
      tags: [Admin]
      summary: Get post-test batch status
      operationId: getPosttestBatch
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Batch status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostTestBatchStatus'

  /admin/posttest-batch/open:
    post:
      tags: [Admin]
      summary: Open post-test for all students
      operationId: openPosttestBatch
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Batch opened

  /admin/posttest-batch/close:
    post:
      tags: [Admin]
      summary: Close post-test batch
      operationId: closePosttestBatch
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Batch closed

  /admin/students/{studentId}/finalize:
    post:
      tags: [Admin]
      summary: Finalize student scores
      operationId: finalizeStudentScores
      security:
        - bearerAuth: []
      parameters:
        - name: studentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Scores finalized
        '400':
          description: Evaluator scores incomplete

  /admin/export:
    get:
      tags: [Admin]
      summary: Export all data
      operationId: exportData
      security:
        - bearerAuth: []
      parameters:
        - name: format
          in: query
          required: true
          schema:
            type: string
            enum: [csv, excel]
      responses:
        '200':
          description: Export file
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Auth
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8

    LoginResponse:
      type: object
      properties:
        accessToken:
          type: string
        expiresIn:
          type: integer
        user:
          $ref: '#/components/schemas/UserInfo'

    TokenResponse:
      type: object
      properties:
        accessToken:
          type: string
        expiresIn:
          type: integer

    ChangePasswordRequest:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 8

    UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        role:
          type: string
          enum: [admin, evaluator, student]

    # Student
    StudentStatus:
      type: object
      properties:
        pretestCompleted:
          type: boolean
        pretestSubmittedAt:
          type: string
          format: date-time
        materialsAccessible:
          type: boolean
        posttestAvailable:
          type: boolean
        posttestCompleted:
          type: boolean
        posttestSubmittedAt:
          type: string
          format: date-time

    QuestionnaireWithAnswers:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        type:
          type: string
          enum: [pretest, posttest]
        totalSteps:
          type: integer
        steps:
          type: array
          items:
            $ref: '#/components/schemas/QuestionnaireStep'
        isSubmitted:
          type: boolean
        submittedAt:
          type: string
          format: date-time

    QuestionnaireStep:
      type: object
      properties:
        stepNumber:
          type: integer
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionWithAnswer'

    QuestionWithAnswer:
      type: object
      properties:
        id:
          type: string
          format: uuid
        text:
          type: string
        questionType:
          type: string
          enum: [likert, truefalse, multiplechoice, dropdown, text]
        options:
          type: array
          items:
            $ref: '#/components/schemas/QuestionOption'
        isRequired:
          type: boolean
        currentAnswer:
          type: string

    QuestionOption:
      type: object
      properties:
        value:
          type: string
        label:
          type: string

    SaveAnswersRequest:
      type: object
      required: [answers]
      properties:
        answers:
          type: array
          items:
            type: object
            properties:
              questionId:
                type: string
                format: uuid
              value:
                type: string

    SaveAnswersResponse:
      type: object
      properties:
        savedAt:
          type: string
          format: date-time
        savedCount:
          type: integer

    SubmissionResponse:
      type: object
      properties:
        submittedAt:
          type: string
          format: date-time
        score:
          type: number
          format: float

    Material:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [pdf, video, text]
        fileSizeBytes:
          type: integer

    MaterialWithUrl:
      allOf:
        - $ref: '#/components/schemas/Material'
        - type: object
          properties:
            accessUrl:
              type: string
              description: Pre-signed URL for file access
            textContent:
              type: string
              description: Content for text type

    TrackAccessRequest:
      type: object
      properties:
        accessId:
          type: string
          format: uuid
        durationSeconds:
          type: integer

    StepTimingRequest:
      type: object
      required: [questionnaireId, stepNumber]
      properties:
        questionnaireId:
          type: string
          format: uuid
        stepNumber:
          type: integer
        action:
          type: string
          enum: [enter, leave]

    # Evaluator
    AssignedStudent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        universityId:
          type: string
        posttestSubmittedAt:
          type: string
          format: date-time
        scoringStatus:
          type: string
          enum: [not_started, in_progress, completed, finalized]

    StudentResponsesForScoring:
      type: object
      properties:
        studentId:
          type: string
          format: uuid
        studentName:
          type: string
        questions:
          type: array
          items:
            $ref: '#/components/schemas/ScoringQuestion'
        totalEvaluatorScore:
          type: number
        isFinalized:
          type: boolean

    ScoringQuestion:
      type: object
      properties:
        questionId:
          type: string
          format: uuid
        text:
          type: string
        studentAnswer:
          type: string
        currentScore:
          type: number
        maxScore:
          type: number
        notes:
          type: string

    SaveScoresRequest:
      type: object
      required: [scores]
      properties:
        scores:
          type: array
          items:
            type: object
            properties:
              questionId:
                type: string
                format: uuid
              score:
                type: number
              notes:
                type: string

    SaveScoresResponse:
      type: object
      properties:
        savedAt:
          type: string
          format: date-time
        totalScore:
          type: number

    # Admin
    DashboardData:
      type: object
      properties:
        totalStudents:
          type: integer
        pretestCompleted:
          type: integer
        materialAccessCount:
          type: integer
        posttestCompleted:
          type: integer
        evaluationsCompleted:
          type: integer
        averageScores:
          type: object
          properties:
            pretest:
              type: number
            posttest:
              type: number
        completionChart:
          type: array
          items:
            type: object
            properties:
              stage:
                type: string
              count:
                type: integer
              percentage:
                type: number

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        role:
          type: string
          enum: [admin, evaluator, student]
        status:
          type: string
          enum: [active, inactive]
        hospital:
          type: string
        createdAt:
          type: string
          format: date-time

    UserDetail:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            universityId:
              type: string
            phone:
              type: string
            department:
              type: string
            gender:
              type: string
            experienceYears:
              type: integer
            lastLoginAt:
              type: string
              format: date-time

    UserListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/User'
        totalCount:
          type: integer
        page:
          type: integer
        pageSize:
          type: integer

    CreateUserRequest:
      type: object
      required: [email, name, role]
      properties:
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [admin, evaluator, student]
        universityId:
          type: string
        phone:
          type: string
        hospital:
          type: string
        department:
          type: string
        gender:
          type: string
          enum: [male, female, other]
        experienceYears:
          type: integer

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
        phone:
          type: string
        hospital:
          type: string
        department:
          type: string

    ImportResult:
      type: object
      properties:
        successCount:
          type: integer
        failedCount:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              row:
                type: integer
              email:
                type: string
              error:
                type: string

    ResetPasswordResponse:
      type: object
      properties:
        temporaryPassword:
          type: string

    EvaluatorAssignment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        evaluatorId:
          type: string
          format: uuid
        evaluatorName:
          type: string
        studentId:
          type: string
          format: uuid
        studentName:
          type: string
        assignedAt:
          type: string
          format: date-time

    CreateAssignmentRequest:
      type: object
      required: [evaluatorId, studentId]
      properties:
        evaluatorId:
          type: string
          format: uuid
        studentId:
          type: string
          format: uuid

    Questionnaire:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        type:
          type: string
          enum: [pretest, posttest]
        isActive:
          type: boolean
        totalSteps:
          type: integer
        questionCount:
          type: integer
        createdAt:
          type: string
          format: date-time

    QuestionnaireDetail:
      allOf:
        - $ref: '#/components/schemas/Questionnaire'
        - type: object
          properties:
            steps:
              type: array
              items:
                $ref: '#/components/schemas/QuestionnaireStepDetail'

    QuestionnaireStepDetail:
      type: object
      properties:
        stepNumber:
          type: integer
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionDetail'

    QuestionDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
        text:
          type: string
        questionType:
          type: string
        options:
          type: array
          items:
            $ref: '#/components/schemas/QuestionOption'
        isRequired:
          type: boolean
        isEvaluatorOnly:
          type: boolean
        scoreWeight:
          type: number
        orderInStep:
          type: integer

    CreateQuestionnaireRequest:
      type: object
      required: [title, type, steps]
      properties:
        title:
          type: string
        type:
          type: string
          enum: [pretest, posttest]
        steps:
          type: array
          items:
            type: object
            properties:
              questions:
                type: array
                items:
                  $ref: '#/components/schemas/CreateQuestionRequest'

    CreateQuestionRequest:
      type: object
      required: [text, questionType]
      properties:
        text:
          type: string
        questionType:
          type: string
          enum: [likert, truefalse, multiplechoice, dropdown, text, evaluator_scoring]
        options:
          type: array
          items:
            $ref: '#/components/schemas/QuestionOption'
        isRequired:
          type: boolean
          default: true
        isEvaluatorOnly:
          type: boolean
          default: false
        scoreWeight:
          type: number
          default: 1

    UpdateQuestionnaireRequest:
      type: object
      properties:
        title:
          type: string
        isActive:
          type: boolean
        steps:
          type: array
          items:
            type: object
            properties:
              questions:
                type: array
                items:
                  $ref: '#/components/schemas/CreateQuestionRequest'

    PostTestBatchStatus:
      type: object
      properties:
        isOpen:
          type: boolean
        openedAt:
          type: string
          format: date-time
        openedBy:
          type: string
        closedAt:
          type: string
          format: date-time
        closedBy:
          type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: array
          items:
            type: string
